from env import TerraformingMarsEnv
import json 
import random

player_state="""
{"cardsInHand":[{"name":"Development Center","calculatedCost":11}],"ceoCardsInHand":[],"dealtCorporationCards":[{"name":"Robinson Industries","calculatedCost":0},{"name":"Celestic","calculatedCost":0}],"dealtPreludeCards":[{"name":"Martian Industries","calculatedCost":0},{"name":"Ecology Experts","calculatedCost":0},{"name":"Galilean Mining","calculatedCost":0},{"name":"Biolab","calculatedCost":0}],"dealtCeoCards":[],"dealtProjectCards":[{"name":"Sulphur-Eating Bacteria","calculatedCost":6},{"name":"Local Shading","calculatedCost":4},{"name":"Extreme-Cold Fungus","calculatedCost":13},{"name":"Dust Seals","calculatedCost":2},{"name":"Martian Rails","calculatedCost":13},{"name":"Development Center","calculatedCost":11},{"name":"Mineral Deposit","calculatedCost":5},{"name":"ArchaeBacteria","calculatedCost":6},{"name":"Space Port Colony","calculatedCost":27},{"name":"Mohole Area","calculatedCost":20}],"draftedCards":[],"game":{"awards":[{"name":"Landlord","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]},{"name":"Scientist","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]},{"name":"Banker","scores":[{"playerColor":"red","playerScore":-2},{"playerColor":"green","playerScore":1}]},{"name":"Thermalist","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]},{"name":"Miner","scores":[{"playerColor":"red","playerScore":1},{"playerColor":"green","playerScore":3}]},{"name":"Venuphile","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]}],"colonies":[{"colonies":[],"isActive":true,"name":"Ceres","trackPosition":0,"visitor":"green"},{"colonies":[],"isActive":false,"name":"Enceladus","trackPosition":1},{"colonies":[],"isActive":true,"name":"Io","trackPosition":1},{"colonies":[],"isActive":false,"name":"Miranda","trackPosition":1},{"colonies":[],"isActive":true,"name":"Pluto","trackPosition":0,"visitor":"red"}],"deckSize":376,"discardedColonies":["Callisto","Europa","Ganymede","Luna","Titan","Triton"],"expectedPurgeTimeMs":1751277418681,"gameAge":41,"gameOptions":{"altVenusBoard":false,"aresExtremeVariant":false,"boardName":"tharsis","bannedCards":[],"draftVariant":true,"escapeVelocityMode":false,"escapeVelocityBonusSeconds":2,"expansions":{"corpera":true,"promo":true,"venus":true,"colonies":true,"prelude":true,"prelude2":false,"turmoil":true,"community":false,"ares":false,"moon":false,"pathfinders":false,"ceo":false,"starwars":false,"underworld":false},"fastModeOption":false,"includedCards":[],"includeFanMA":false,"initialDraftVariant":false,"preludeDraftVariant":true,"politicalAgendasExtension":"Standard","removeNegativeGlobalEvents":false,"showOtherPlayersVP":false,"showTimers":true,"shuffleMapOption":false,"solarPhaseOption":true,"soloTR":false,"randomMA":"No randomization","requiresMoonTrackCompletion":false,"requiresVenusTrackCompletion":false,"twoCorpsVariant":false,"undoOption":false},"generation":1,"globalsPerGeneration":[],"isSoloModeWin":false,"isTerraformed":false,"lastSoloGeneration":12,"milestones":[{"name":"Terraformer","scores":[{"playerColor":"red","playerScore":20},{"playerColor":"green","playerScore":20}]},{"name":"Mayor","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]},{"name":"Gardener","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]},{"name":"Builder","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":1}]},{"name":"Planner","scores":[{"playerColor":"red","playerScore":1},{"playerColor":"green","playerScore":1}]},{"name":"Hoverlord","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]}],"oceans":0,"oxygenLevel":0,"passedPlayers":[],"phase":"action","spaces":[{"x":-1,"y":-1,"id":"01","spaceType":"colony","bonus":[]},{"x":-1,"y":-1,"id":"02","spaceType":"colony","bonus":[]},{"x":4,"y":0,"id":"03","spaceType":"land","bonus":[1,1]},{"x":5,"y":0,"id":"04","spaceType":"ocean","bonus":[1,1]},{"x":6,"y":0,"id":"05","spaceType":"land","bonus":[]},{"x":7,"y":0,"id":"06","spaceType":"ocean","bonus":[3]},{"x":8,"y":0,"id":"07","spaceType":"ocean","bonus":[]},{"x":3,"y":1,"id":"08","spaceType":"land","bonus":[]},{"x":4,"y":1,"id":"09","spaceType":"land","bonus":[1]},{"x":5,"y":1,"id":"10","spaceType":"land","bonus":[]},{"x":6,"y":1,"id":"11","spaceType":"land","bonus":[]},{"x":7,"y":1,"id":"12","spaceType":"land","bonus":[]},{"x":8,"y":1,"id":"13","spaceType":"ocean","bonus":[3,3]},{"x":2,"y":2,"id":"14","spaceType":"land","bonus":[3]},{"x":3,"y":2,"id":"15","spaceType":"land","bonus":[]},{"x":4,"y":2,"id":"16","spaceType":"land","bonus":[]},{"x":5,"y":2,"id":"17","spaceType":"land","bonus":[]},{"x":6,"y":2,"id":"18","spaceType":"land","bonus":[]},{"x":7,"y":2,"id":"19","spaceType":"land","bonus":[]},{"x":8,"y":2,"id":"20","spaceType":"land","bonus":[1]},{"x":1,"y":3,"id":"21","spaceType":"land","bonus":[2,0]},{"x":2,"y":3,"id":"22","spaceType":"land","bonus":[2]},{"x":3,"y":3,"id":"23","spaceType":"land","bonus":[2]},{"x":4,"y":3,"id":"24","spaceType":"land","bonus":[2]},{"x":5,"y":3,"id":"25","spaceType":"land","bonus":[2,2]},{"x":6,"y":3,"id":"26","spaceType":"land","bonus":[2]},{"x":7,"y":3,"id":"27","spaceType":"land","bonus":[2]},{"x":8,"y":3,"id":"28","spaceType":"ocean","bonus":[2,2]},{"x":0,"y":4,"id":"29","spaceType":"land","bonus":[2,2]},{"x":1,"y":4,"id":"30","spaceType":"land","bonus":[2,2]},{"x":2,"y":4,"id":"31","spaceType":"land","bonus":[2,2]},{"x":3,"y":4,"id":"32","spaceType":"ocean","bonus":[2,2]},{"x":4,"y":4,"id":"33","spaceType":"ocean","bonus":[2,2]},{"x":5,"y":4,"id":"34","spaceType":"ocean","bonus":[2,2]},{"x":6,"y":4,"id":"35","spaceType":"land","bonus":[2,2]},{"x":7,"y":4,"id":"36","spaceType":"land","bonus":[2,2]},{"x":8,"y":4,"id":"37","spaceType":"land","bonus":[2,2]},{"x":1,"y":5,"id":"38","spaceType":"land","bonus":[2]},{"x":2,"y":5,"id":"39","spaceType":"land","bonus":[2,2]},{"x":3,"y":5,"id":"40","spaceType":"land","bonus":[2]},{"x":4,"y":5,"id":"41","spaceType":"land","bonus":[2]},{"x":5,"y":5,"id":"42","spaceType":"land","bonus":[2]},{"x":6,"y":5,"id":"43","spaceType":"ocean","bonus":[2]},{"x":7,"y":5,"id":"44","spaceType":"ocean","bonus":[2]},{"x":8,"y":5,"id":"45","spaceType":"ocean","bonus":[2]},{"x":2,"y":6,"id":"46","spaceType":"land","bonus":[]},{"x":3,"y":6,"id":"47","spaceType":"land","bonus":[]},{"x":4,"y":6,"id":"48","spaceType":"land","bonus":[]},{"x":5,"y":6,"id":"49","spaceType":"land","bonus":[]},{"x":6,"y":6,"id":"50","spaceType":"land","bonus":[]},{"x":7,"y":6,"id":"51","spaceType":"land","bonus":[2]},{"x":8,"y":6,"id":"52","spaceType":"land","bonus":[]},{"x":3,"y":7,"id":"53","spaceType":"land","bonus":[1,1]},{"x":4,"y":7,"id":"54","spaceType":"land","bonus":[]},{"x":5,"y":7,"id":"55","spaceType":"land","bonus":[3]},{"x":6,"y":7,"id":"56","spaceType":"land","bonus":[3]},{"x":7,"y":7,"id":"57","spaceType":"land","bonus":[]},{"x":8,"y":7,"id":"58","spaceType":"land","bonus":[0]},{"x":4,"y":8,"id":"59","spaceType":"land","bonus":[1]},{"x":5,"y":8,"id":"60","spaceType":"land","bonus":[1,1]},{"x":6,"y":8,"id":"61","spaceType":"land","bonus":[]},{"x":7,"y":8,"id":"62","spaceType":"land","bonus":[]},{"x":8,"y":8,"id":"63","spaceType":"ocean","bonus":[0,0]},{"x":-1,"y":-1,"id":"69","spaceType":"colony","bonus":[]},{"x":-1,"y":-1,"id":"71","spaceType":"colony","bonus":[]},{"x":-1,"y":-1,"id":"70","spaceType":"colony","bonus":[]},{"x":-1,"y":-1,"id":"73","spaceType":"colony","bonus":[]},{"x":-1,"y":-1,"id":"72","spaceType":"colony","bonus":[]}],"spectatorId":"sd5e07bec0dda","step":9,"temperature":-30,"tags":["space","animal","city","building","earth","science","jovian","microbe","plant","power","venus","wild"],"turmoil":{"chairman":"neutral","ruling":"Greens","dominant":"Greens","parties":[{"name":"Mars First","delegates":[]},{"name":"Scientists","delegates":[]},{"name":"Unity","delegates":[]},{"name":"Greens","partyLeader":"neutral","delegates":[{"color":"neutral","number":1}]},{"name":"Reds","delegates":[]},{"name":"Kelvinists","partyLeader":"neutral","delegates":[{"color":"neutral","number":1}]}],"lobby":["red","green"],"reserve":[{"color":"red","number":6},{"color":"green","number":6},{"color":"neutral","number":11}],"distant":"Corrosive Rain","coming":"Spin-Off Products","politicalAgendas":{"marsFirst":{"bonusId":"mb01","policyId":"mp01"},"scientists":{"bonusId":"sb01","policyId":"sp01"},"unity":{"bonusId":"ub01","policyId":"up01"},"greens":{"bonusId":"gb01","policyId":"gp01"},"reds":{"bonusId":"rb01","policyId":"rp01"},"kelvinists":{"bonusId":"kb01","policyId":"kp01"}},"policyActionUsers":[{"color":"red","turmoilPolicyActionUsed":false,"politicalAgendasActionUsedCount":0},{"color":"green","turmoilPolicyActionUsed":false,"politicalAgendasActionUsedCount":0}]},"undoCount":0,"venusScaleLevel":0},"id":"p6c430535a1d0","runId":"r24aa95ebbf4c","pickedCorporationCard":[{"name":"Robinson Industries","calculatedCost":0}],"preludeCardsInHand":[],"thisPlayer":{"actionsTakenThisRound":1,"actionsTakenThisGame":3,"actionsThisGeneration":["Robinson Industries"],"availableBlueCardActionCount":0,"cardCost":3,"cardDiscount":0,"cardsInHandNbr":1,"citiesCount":0,"coloniesCount":0,"color":"green","energy":0,"energyProduction":1,"fleetSize":1,"heat":0,"heatProduction":0,"influence":0,"isActive":true,"lastCardPlayed":"Dust Seals","megaCredits":26,"megaCreditProduction":1,"name":"Green","needsToResearch":true,"noTagsCount":2,"plants":0,"plantProduction":1,"protectedResources":{"megacredits":"off","steel":"off","titanium":"off","plants":"off","energy":"off","heat":"off"},"protectedProduction":{"megacredits":"off","steel":"off","titanium":"off","plants":"off","energy":"off","heat":"off"},"tableau":[{"resources":0,"name":"Robinson Industries","calculatedCost":0},{"resources":0,"name":"Martian Industries","calculatedCost":0},{"resources":0,"name":"Ecology Experts","calculatedCost":0},{"resources":0,"name":"Dust Seals","calculatedCost":2}],"selfReplicatingRobotsCards":[],"steel":2,"steelProduction":1,"steelValue":2,"tags":{"building":1,"space":0,"science":0,"power":0,"earth":0,"jovian":0,"venus":0,"moon":0,"mars":0,"plant":1,"microbe":1,"animal":0,"crime":0,"city":0,"wild":0,"clone":0,"event":0},"terraformRating":20,"timer":{"sumElapsed":717,"startedAt":1750413420180,"running":true,"afterFirstAction":true,"lastStoppedAt":1750413420180},"titanium":0,"titaniumProduction":0,"titaniumValue":3,"tradesThisGeneration":1,"corruption":0,"victoryPointsBreakdown":{"terraformRating":0,"milestones":0,"awards":0,"greenery":0,"city":0,"escapeVelocity":0,"moonHabitats":0,"moonMines":0,"moonRoads":0,"planetaryTracks":0,"victoryPoints":0,"total":0,"detailsCards":[],"detailsMilestones":[],"detailsAwards":[],"detailsPlanetaryTracks":[],"negativeVP":0},"victoryPointsByGeneration":[],"excavations":0},"waitingFor":{"title":"Take your next action","buttonLabel":"Take action","type":"or","options":[{"title":"Play project card","buttonLabel":"Play card","type":"projectCard","cards":[{"name":"Development Center","calculatedCost":11,"reserveUnits":{"megacredits":0,"steel":0,"titanium":0,"plants":0,"energy":0,"heat":0}}],"microbes":0,"floaters":0,"paymentOptions":{"heat":false,"lunaTradeFederationTitanium":false,"plants":false,"corruption":false},"lunaArchivesScience":0,"seeds":0,"graphene":0,"kuiperAsteroids":0,"corruption":0},{"title":"Send a delegate in an area (from lobby)","buttonLabel":"Send delegate","type":"party","parties":["Mars First","Scientists","Unity","Greens","Reds","Kelvinists"]},{"title":"End Turn","buttonLabel":"End","type":"option"},{"title":{"data":[{"type":1,"value":"8"}],"message":"Fund an award (${0} M€)"},"buttonLabel":"Confirm","type":"or","options":[{"title":"Landlord","buttonLabel":"Fund - (Landlord)","type":"option"},{"title":"Scientist","buttonLabel":"Fund - (Scientist)","type":"option"},{"title":"Banker","buttonLabel":"Fund - (Banker)","type":"option"},{"title":"Thermalist","buttonLabel":"Fund - (Thermalist)","type":"option"},{"title":"Miner","buttonLabel":"Fund - (Miner)","type":"option"},{"title":"Venuphile","buttonLabel":"Fund - (Venuphile)","type":"option"}],"initialIdx":0},{"title":"Standard projects","buttonLabel":"Confirm","type":"card","cards":[{"resources":0,"name":"Power Plant:SP","calculatedCost":11},{"resources":0,"name":"Asteroid:SP","calculatedCost":14},{"resources":0,"name":"Air Scrapping","calculatedCost":15},{"resources":0,"name":"Colony","calculatedCost":17},{"resources":0,"name":"Aquifer","calculatedCost":18},{"resources":0,"name":"Greenery","calculatedCost":23},{"resources":0,"name":"City","calculatedCost":25}],"max":1,"min":1,"showOnlyInLearnerMode":false,"selectBlueCardAction":false,"showOwner":false},{"title":"Pass for this generation","buttonLabel":"Pass","type":"option"},{"title":"Sell patents","buttonLabel":"Sell","type":"card","cards":[{"name":"Development Center","calculatedCost":11}],"max":1,"min":1,"showOnlyInLearnerMode":false,"selectBlueCardAction":false,"showOwner":false}],"initialIdx":0},"players":[{"actionsTakenThisRound":0,"actionsTakenThisGame":4,"actionsThisGeneration":[],"availableBlueCardActionCount":1,"cardCost":3,"cardDiscount":0,"cardsInHandNbr":1,"citiesCount":0,"coloniesCount":0,"color":"red","energy":0,"energyProduction":0,"fleetSize":1,"heat":0,"heatProduction":0,"influence":0,"isActive":false,"lastCardPlayed":"Space Mirrors","megaCredits":7,"megaCreditProduction":-2,"name":"Red","needsToResearch":true,"noTagsCount":1,"plants":0,"plantProduction":4,"protectedResources":{"megacredits":"off","steel":"off","titanium":"off","plants":"off","energy":"off","heat":"off"},"protectedProduction":{"megacredits":"off","steel":"off","titanium":"off","plants":"off","energy":"off","heat":"off"},"tableau":[{"resources":0,"name":"Viron","calculatedCost":0},{"resources":0,"name":"Biosphere Support","calculatedCost":0},{"resources":0,"name":"Double Down","calculatedCost":0},{"resources":0,"name":"Vesta Shipyard","calculatedCost":15},{"resources":0,"name":"Space Mirrors","calculatedCost":3}],"selfReplicatingRobotsCards":[],"steel":0,"steelProduction":0,"steelValue":2,"tags":{"building":0,"space":2,"science":0,"power":1,"earth":0,"jovian":1,"venus":0,"moon":0,"mars":0,"plant":1,"microbe":1,"animal":0,"crime":0,"city":0,"wild":0,"clone":0,"event":0},"terraformRating":20,"timer":{"sumElapsed":612,"startedAt":1750413419900,"running":false,"afterFirstAction":true,"lastStoppedAt":1750413420180},"titanium":0,"titaniumProduction":1,"titaniumValue":3,"tradesThisGeneration":1,"corruption":0,"victoryPointsBreakdown":{"terraformRating":0,"milestones":0,"awards":0,"greenery":0,"city":0,"escapeVelocity":0,"moonHabitats":0,"moonMines":0,"moonRoads":0,"planetaryTracks":0,"victoryPoints":0,"total":0,"detailsCards":[],"detailsMilestones":[],"detailsAwards":[],"detailsPlanetaryTracks":[],"negativeVP":0},"victoryPointsByGeneration":[],"excavations":0},{"actionsTakenThisRound":1,"actionsTakenThisGame":3,"actionsThisGeneration":["Robinson Industries"],"availableBlueCardActionCount":0,"cardCost":3,"cardDiscount":0,"cardsInHandNbr":1,"citiesCount":0,"coloniesCount":0,"color":"green","energy":0,"energyProduction":1,"fleetSize":1,"heat":0,"heatProduction":0,"influence":0,"isActive":true,"lastCardPlayed":"Dust Seals","megaCredits":26,"megaCreditProduction":1,"name":"Green","needsToResearch":true,"noTagsCount":2,"plants":0,"plantProduction":1,"protectedResources":{"megacredits":"off","steel":"off","titanium":"off","plants":"off","energy":"off","heat":"off"},"protectedProduction":{"megacredits":"off","steel":"off","titanium":"off","plants":"off","energy":"off","heat":"off"},"tableau":[{"resources":0,"name":"Robinson Industries","calculatedCost":0},{"resources":0,"name":"Martian Industries","calculatedCost":0},{"resources":0,"name":"Ecology Experts","calculatedCost":0},{"resources":0,"name":"Dust Seals","calculatedCost":2}],"selfReplicatingRobotsCards":[],"steel":2,"steelProduction":1,"steelValue":2,"tags":{"building":1,"space":0,"science":0,"power":0,"earth":0,"jovian":0,"venus":0,"moon":0,"mars":0,"plant":1,"microbe":1,"animal":0,"crime":0,"city":0,"wild":0,"clone":0,"event":0},"terraformRating":20,"timer":{"sumElapsed":717,"startedAt":1750413420180,"running":true,"afterFirstAction":true,"lastStoppedAt":1750413420180},"titanium":0,"titaniumProduction":0,"titaniumValue":3,"tradesThisGeneration":1,"corruption":0,"victoryPointsBreakdown":{"terraformRating":0,"milestones":0,"awards":0,"greenery":0,"city":0,"escapeVelocity":0,"moonHabitats":0,"moonMines":0,"moonRoads":0,"planetaryTracks":0,"victoryPoints":0,"total":0,"detailsCards":[],"detailsMilestones":[],"detailsAwards":[],"detailsPlanetaryTracks":[],"negativeVP":0},"victoryPointsByGeneration":[],"excavations":0}],"autopass":false}"""

waiting_for={'title': 'Play project card', 'buttonLabel': 'Play card', 'type': 'projectCard', 'cards': [{'name': 'Imported Hydrogen', 'calculatedCost': 0, 'reserveUnits': {'megacredits': 0, 'steel': 0, 'titanium': 0, 'plants': 0, 'energy': 0, 'heat': 0}}, {'name': 'Ganymede Colony', 'calculatedCost': 0, 'reserveUnits': {'megacredits': 0, 'steel': 0, 'titanium': 0, 'plants': 0, 'energy': 0, 'heat': 0}}], 'microbes': 0, 'floaters': 0, 'paymentOptions': {'heat': True, 'lunaTradeFederationTitanium': False, 'plants': False, 'corruption': False}, 'lunaArchivesScience': 0, 'seeds': 0, 'graphene': 0, 'kuiperAsteroids': 0, 'corruption': 0}
player_id="pbc07ea787b11"
player_state=json.loads(player_state)
waiting_for=None
NON_STOP=True
env=TerraformingMarsEnv(["1","2"],init_from_player_state=True,player_state=player_state if not player_id else None,player_id=player_id,waiting_for=waiting_for)
print(env.player_states['1'].get('waitingFor'))
i=0
for id,action in env.action_lookup['1'].items():
    if i>30:
        break
    i=i+1
    print(f"Action id: {id}, action: {json.dumps(action)}")
    
if NON_STOP:
    env=TerraformingMarsEnv(["1","2"])
    rand=random.Random()
    next_obs, rewards, terms, truncs, infos=(None,None,None,None,None)
    while True:
        actions={}
        is_no_actions=True
        for agent in env.action_lookup:
            max_actions=len(env.action_lookup[agent].keys())
            if max_actions>1:
                actions[agent]=int(rand.randrange(0,max_actions-1))
                is_no_actions=False
            elif max_actions==0:
                actions[agent]=0
            else:
                is_no_actions=False
                actions[agent]=0
        if terms and terms.get('1',False):
            terms=None
            env=TerraformingMarsEnv(["1","2"])
        else:
            next_obs, rewards, terms, truncs, infos=env.step(actions)
    
