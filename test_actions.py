from decision_mapper import DecisionContext, TerraformingMarsDecisionMapper
from env import TerraformingMarsEnv, get_player_state
import json 
import random

player_state="""
{"cardsInHand":[{"name":"Ganymede Colony","calculatedCost":20}],"ceoCardsInHand":[],"dealtCorporationCards":[{"name":"Helion","calculatedCost":0},{"name":"Saturn Systems","calculatedCost":0}],"dealtPreludeCards":[{"name":"Eccentric Sponsor","calculatedCost":0},{"name":"Biofuels","calculatedCost":0},{"name":"Aquifer Turbines","calculatedCost":0},{"name":"Nitrogen Shipment","calculatedCost":0}],"dealtCeoCards":[],"dealtProjectCards":[{"name":"Equatorial Magnetizer","calculatedCost":11},{"name":"Jovian Lanterns","calculatedCost":20},{"name":"Vote Of No Confidence","calculatedCost":5},{"name":"Asteroid","calculatedCost":14},{"name":"Nuclear Zone","calculatedCost":10},{"name":"Space Port","calculatedCost":22},{"name":"Ice Cap Melting","calculatedCost":5},{"name":"Imported Hydrogen","calculatedCost":16},{"name":"Heavy Taxation","calculatedCost":3},{"name":"Ganymede Colony","calculatedCost":20}],"draftedCards":[],"game":{"awards":[{"name":"Landlord","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]},{"name":"Scientist","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]},{"name":"Banker","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]},{"name":"Thermalist","scores":[{"playerColor":"red","playerScore":3},{"playerColor":"green","playerScore":0}]},{"name":"Miner","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]},{"name":"Venuphile","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]}],"colonies":[{"colonies":[],"isActive":true,"name":"Ceres","trackPosition":1},{"colonies":[],"isActive":true,"name":"Europa","trackPosition":1},{"colonies":[],"isActive":true,"name":"Ganymede","trackPosition":1},{"colonies":[],"isActive":true,"name":"Io","trackPosition":1},{"colonies":[],"isActive":false,"name":"Miranda","trackPosition":1}],"deckSize":370,"discardedColonies":["Callisto","Enceladus","Luna","Pluto","Titan","Triton"],"expectedPurgeTimeMs":1751555691335,"gameAge":20,"gameOptions":{"altVenusBoard":false,"aresExtremeVariant":false,"boardName":"tharsis","bannedCards":[],"draftVariant":true,"escapeVelocityMode":false,"escapeVelocityBonusSeconds":2,"expansions":{"corpera":true,"promo":true,"venus":true,"colonies":true,"prelude":true,"prelude2":false,"turmoil":true,"community":false,"ares":false,"moon":false,"pathfinders":false,"ceo":false,"starwars":false,"underworld":false},"fastModeOption":false,"includedCards":[],"includeFanMA":false,"initialDraftVariant":false,"preludeDraftVariant":true,"politicalAgendasExtension":"Standard","removeNegativeGlobalEvents":false,"showOtherPlayersVP":false,"showTimers":true,"shuffleMapOption":false,"solarPhaseOption":true,"soloTR":false,"randomMA":"No randomization","requiresMoonTrackCompletion":false,"requiresVenusTrackCompletion":false,"twoCorpsVariant":false,"undoOption":false},"generation":1,"globalsPerGeneration":[],"isSoloModeWin":false,"isTerraformed":false,"lastSoloGeneration":12,"milestones":[{"name":"Terraformer","scores":[{"playerColor":"red","playerScore":20},{"playerColor":"green","playerScore":20}]},{"name":"Mayor","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]},{"name":"Gardener","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]},{"name":"Builder","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]},{"name":"Planner","scores":[{"playerColor":"red","playerScore":1},{"playerColor":"green","playerScore":5}]},{"name":"Hoverlord","scores":[{"playerColor":"red","playerScore":0},{"playerColor":"green","playerScore":0}]}],"oceans":0,"oxygenLevel":0,"passedPlayers":[],"phase":"preludes","spaces":[{"x":-1,"y":-1,"id":"01","spaceType":"colony","bonus":[]},{"x":-1,"y":-1,"id":"02","spaceType":"colony","bonus":[]},{"x":4,"y":0,"id":"03","spaceType":"land","bonus":[1,1]},{"x":5,"y":0,"id":"04","spaceType":"ocean","bonus":[1,1]},{"x":6,"y":0,"id":"05","spaceType":"land","bonus":[]},{"x":7,"y":0,"id":"06","spaceType":"ocean","bonus":[3]},{"x":8,"y":0,"id":"07","spaceType":"ocean","bonus":[]},{"x":3,"y":1,"id":"08","spaceType":"land","bonus":[]},{"x":4,"y":1,"id":"09","spaceType":"land","bonus":[1]},{"x":5,"y":1,"id":"10","spaceType":"land","bonus":[]},{"x":6,"y":1,"id":"11","spaceType":"land","bonus":[]},{"x":7,"y":1,"id":"12","spaceType":"land","bonus":[]},{"x":8,"y":1,"id":"13","spaceType":"ocean","bonus":[3,3]},{"x":2,"y":2,"id":"14","spaceType":"land","bonus":[3]},{"x":3,"y":2,"id":"15","spaceType":"land","bonus":[]},{"x":4,"y":2,"id":"16","spaceType":"land","bonus":[]},{"x":5,"y":2,"id":"17","spaceType":"land","bonus":[]},{"x":6,"y":2,"id":"18","spaceType":"land","bonus":[]},{"x":7,"y":2,"id":"19","spaceType":"land","bonus":[]},{"x":8,"y":2,"id":"20","spaceType":"land","bonus":[1]},{"x":1,"y":3,"id":"21","spaceType":"land","bonus":[2,0]},{"x":2,"y":3,"id":"22","spaceType":"land","bonus":[2]},{"x":3,"y":3,"id":"23","spaceType":"land","bonus":[2]},{"x":4,"y":3,"id":"24","spaceType":"land","bonus":[2]},{"x":5,"y":3,"id":"25","spaceType":"land","bonus":[2,2]},{"x":6,"y":3,"id":"26","spaceType":"land","bonus":[2]},{"x":7,"y":3,"id":"27","spaceType":"land","bonus":[2]},{"x":8,"y":3,"id":"28","spaceType":"ocean","bonus":[2,2]},{"x":0,"y":4,"id":"29","spaceType":"land","bonus":[2,2]},{"x":1,"y":4,"id":"30","spaceType":"land","bonus":[2,2]},{"x":2,"y":4,"id":"31","spaceType":"land","bonus":[2,2]},{"x":3,"y":4,"id":"32","spaceType":"ocean","bonus":[2,2]},{"x":4,"y":4,"id":"33","spaceType":"ocean","bonus":[2,2]},{"x":5,"y":4,"id":"34","spaceType":"ocean","bonus":[2,2]},{"x":6,"y":4,"id":"35","spaceType":"land","bonus":[2,2]},{"x":7,"y":4,"id":"36","spaceType":"land","bonus":[2,2]},{"x":8,"y":4,"id":"37","spaceType":"land","bonus":[2,2]},{"x":1,"y":5,"id":"38","spaceType":"land","bonus":[2]},{"x":2,"y":5,"id":"39","spaceType":"land","bonus":[2,2]},{"x":3,"y":5,"id":"40","spaceType":"land","bonus":[2]},{"x":4,"y":5,"id":"41","spaceType":"land","bonus":[2]},{"x":5,"y":5,"id":"42","spaceType":"land","bonus":[2]},{"x":6,"y":5,"id":"43","spaceType":"ocean","bonus":[2]},{"x":7,"y":5,"id":"44","spaceType":"ocean","bonus":[2]},{"x":8,"y":5,"id":"45","spaceType":"ocean","bonus":[2]},{"x":2,"y":6,"id":"46","spaceType":"land","bonus":[]},{"x":3,"y":6,"id":"47","spaceType":"land","bonus":[]},{"x":4,"y":6,"id":"48","spaceType":"land","bonus":[]},{"x":5,"y":6,"id":"49","spaceType":"land","bonus":[]},{"x":6,"y":6,"id":"50","spaceType":"land","bonus":[]},{"x":7,"y":6,"id":"51","spaceType":"land","bonus":[2]},{"x":8,"y":6,"id":"52","spaceType":"land","bonus":[]},{"x":3,"y":7,"id":"53","spaceType":"land","bonus":[1,1]},{"x":4,"y":7,"id":"54","spaceType":"land","bonus":[]},{"x":5,"y":7,"id":"55","spaceType":"land","bonus":[3]},{"x":6,"y":7,"id":"56","spaceType":"land","bonus":[3]},{"x":7,"y":7,"id":"57","spaceType":"land","bonus":[]},{"x":8,"y":7,"id":"58","spaceType":"land","bonus":[0]},{"x":4,"y":8,"id":"59","spaceType":"land","bonus":[1]},{"x":5,"y":8,"id":"60","spaceType":"land","bonus":[1,1]},{"x":6,"y":8,"id":"61","spaceType":"land","bonus":[]},{"x":7,"y":8,"id":"62","spaceType":"land","bonus":[]},{"x":8,"y":8,"id":"63","spaceType":"ocean","bonus":[0,0]},{"x":-1,"y":-1,"id":"69","spaceType":"colony","bonus":[]},{"x":-1,"y":-1,"id":"71","spaceType":"colony","bonus":[]},{"x":-1,"y":-1,"id":"70","spaceType":"colony","bonus":[]},{"x":-1,"y":-1,"id":"73","spaceType":"colony","bonus":[]},{"x":-1,"y":-1,"id":"72","spaceType":"colony","bonus":[]}],"spectatorId":"s160bd784aff3","step":2,"temperature":-30,"tags":["jovian","building","space","venus","animal","city","power","microbe","earth","science","plant","wild"],"turmoil":{"chairman":"neutral","ruling":"Greens","dominant":"Mars First","parties":[{"name":"Mars First","partyLeader":"neutral","delegates":[{"color":"neutral","number":1}]},{"name":"Scientists","delegates":[]},{"name":"Unity","partyLeader":"neutral","delegates":[{"color":"neutral","number":1}]},{"name":"Greens","delegates":[]},{"name":"Reds","delegates":[]},{"name":"Kelvinists","delegates":[]}],"lobby":["red","green"],"reserve":[{"color":"red","number":6},{"color":"green","number":6},{"color":"neutral","number":11}],"distant":"Celebrity Leaders","coming":"Venus Infrastructure","politicalAgendas":{"marsFirst":{"bonusId":"mb01","policyId":"mp01"},"scientists":{"bonusId":"sb01","policyId":"sp01"},"unity":{"bonusId":"ub01","policyId":"up01"},"greens":{"bonusId":"gb01","policyId":"gp01"},"reds":{"bonusId":"rb01","policyId":"rp01"},"kelvinists":{"bonusId":"kb01","policyId":"kp01"}},"policyActionUsers":[{"color":"red","turmoilPolicyActionUsed":false,"politicalAgendasActionUsedCount":0},{"color":"green","turmoilPolicyActionUsed":false,"politicalAgendasActionUsedCount":0}]},"undoCount":0,"venusScaleLevel":0},"id":"pd0e4eb21a29f","runId":"r24aa95ebbf4c","pickedCorporationCard":[{"name":"Helion","calculatedCost":0}],"preludeCardsInHand":[{"name":"Biofuels","calculatedCost":0}],"thisPlayer":{"actionsTakenThisRound":0,"actionsTakenThisGame":0,"actionsThisGeneration":[],"availableBlueCardActionCount":0,"cardCost":3,"cardDiscount":0,"cardsInHandNbr":1,"citiesCount":0,"coloniesCount":0,"color":"red","energy":0,"energyProduction":0,"fleetSize":1,"heat":0,"heatProduction":3,"influence":0,"isActive":true,"lastCardPlayed":"Imported Hydrogen","megaCredits":36,"megaCreditProduction":0,"name":"Red","needsToResearch":true,"noTagsCount":1,"plants":3,"plantProduction":0,"protectedResources":{"megacredits":"off","steel":"off","titanium":"off","plants":"off","energy":"off","heat":"off"},"protectedProduction":{"megacredits":"off","steel":"off","titanium":"off","plants":"off","energy":"off","heat":"off"},"tableau":[{"resources":0,"name":"Helion","calculatedCost":0},{"resources":0,"name":"Eccentric Sponsor","calculatedCost":0},{"resources":0,"name":"Imported Hydrogen","calculatedCost":16}],"selfReplicatingRobotsCards":[],"steel":0,"steelProduction":0,"steelValue":2,"tags":{"building":0,"space":1,"science":0,"power":0,"earth":0,"jovian":0,"venus":0,"moon":0,"mars":0,"plant":0,"microbe":0,"animal":0,"crime":0,"city":0,"wild":0,"clone":0,"event":1},"terraformRating":20,"timer":{"sumElapsed":63515874,"startedAt":1750755207330,"running":true,"afterFirstAction":true,"lastStoppedAt":1750755207330},"titanium":0,"titaniumProduction":0,"titaniumValue":3,"tradesThisGeneration":0,"corruption":0,"victoryPointsBreakdown":{"terraformRating":0,"milestones":0,"awards":0,"greenery":0,"city":0,"escapeVelocity":0,"moonHabitats":0,"moonMines":0,"moonRoads":0,"planetaryTracks":0,"victoryPoints":0,"total":0,"detailsCards":[],"detailsMilestones":[],"detailsAwards":[],"detailsPlanetaryTracks":[],"negativeVP":0},"victoryPointsByGeneration":[],"excavations":0},"waitingFor":{"title":"Select space for ocean tile","buttonLabel":"Save","type":"space","spaces":["04","06","07","13","28","32","33","34","43","44","45","63"]},"players":[{"actionsTakenThisRound":0,"actionsTakenThisGame":0,"actionsThisGeneration":[],"availableBlueCardActionCount":0,"cardCost":3,"cardDiscount":0,"cardsInHandNbr":1,"citiesCount":0,"coloniesCount":0,"color":"red","energy":0,"energyProduction":0,"fleetSize":1,"heat":0,"heatProduction":3,"influence":0,"isActive":true,"lastCardPlayed":"Imported Hydrogen","megaCredits":36,"megaCreditProduction":0,"name":"Red","needsToResearch":true,"noTagsCount":1,"plants":3,"plantProduction":0,"protectedResources":{"megacredits":"off","steel":"off","titanium":"off","plants":"off","energy":"off","heat":"off"},"protectedProduction":{"megacredits":"off","steel":"off","titanium":"off","plants":"off","energy":"off","heat":"off"},"tableau":[{"resources":0,"name":"Helion","calculatedCost":0},{"resources":0,"name":"Eccentric Sponsor","calculatedCost":0},{"resources":0,"name":"Imported Hydrogen","calculatedCost":16}],"selfReplicatingRobotsCards":[],"steel":0,"steelProduction":0,"steelValue":2,"tags":{"building":0,"space":1,"science":0,"power":0,"earth":0,"jovian":0,"venus":0,"moon":0,"mars":0,"plant":0,"microbe":0,"animal":0,"crime":0,"city":0,"wild":0,"clone":0,"event":1},"terraformRating":20,"timer":{"sumElapsed":63515874,"startedAt":1750755207330,"running":true,"afterFirstAction":true,"lastStoppedAt":1750755207330},"titanium":0,"titaniumProduction":0,"titaniumValue":3,"tradesThisGeneration":0,"corruption":0,"victoryPointsBreakdown":{"terraformRating":0,"milestones":0,"awards":0,"greenery":0,"city":0,"escapeVelocity":0,"moonHabitats":0,"moonMines":0,"moonRoads":0,"planetaryTracks":0,"victoryPoints":0,"total":0,"detailsCards":[],"detailsMilestones":[],"detailsAwards":[],"detailsPlanetaryTracks":[],"negativeVP":0},"victoryPointsByGeneration":[],"excavations":0},{"actionsTakenThisRound":0,"actionsTakenThisGame":0,"actionsThisGeneration":[],"availableBlueCardActionCount":0,"cardCost":3,"cardDiscount":0,"cardsInHandNbr":5,"citiesCount":0,"coloniesCount":0,"color":"green","energy":0,"energyProduction":0,"fleetSize":1,"heat":0,"heatProduction":0,"influence":0,"isActive":false,"megaCredits":34,"megaCreditProduction":0,"name":"Green","needsToResearch":true,"noTagsCount":0,"plants":0,"plantProduction":0,"protectedResources":{"megacredits":"off","steel":"off","titanium":"off","plants":"off","energy":"off","heat":"off"},"protectedProduction":{"megacredits":"off","steel":"off","titanium":"off","plants":"off","energy":"off","heat":"off"},"tableau":[{"resources":2,"name":"Pharmacy Union","calculatedCost":0}],"selfReplicatingRobotsCards":[],"steel":0,"steelProduction":0,"steelValue":2,"tags":{"building":0,"space":0,"science":0,"power":0,"earth":0,"jovian":0,"venus":0,"moon":0,"mars":0,"plant":0,"microbe":2,"animal":0,"crime":0,"city":0,"wild":0,"clone":0,"event":0},"terraformRating":20,"timer":{"sumElapsed":0,"startedAt":1750691691109,"running":false,"afterFirstAction":true,"lastStoppedAt":1750755207330},"titanium":0,"titaniumProduction":0,"titaniumValue":3,"tradesThisGeneration":0,"corruption":0,"victoryPointsBreakdown":{"terraformRating":0,"milestones":0,"awards":0,"greenery":0,"city":0,"escapeVelocity":0,"moonHabitats":0,"moonMines":0,"moonRoads":0,"planetaryTracks":0,"victoryPoints":0,"total":0,"detailsCards":[],"detailsMilestones":[],"detailsAwards":[],"detailsPlanetaryTracks":[],"negativeVP":0},"victoryPointsByGeneration":[],"excavations":0}],"autopass":false}
"""
waiting_for={'title': 'Play project card', 'buttonLabel': 'Play card', 'type': 'projectCard', 'cards': [{'name': 'Imported Hydrogen', 'calculatedCost': 0, 'reserveUnits': {'megacredits': 0, 'steel': 0, 'titanium': 0, 'plants': 0, 'energy': 0, 'heat': 0}}, {'name': 'Ganymede Colony', 'calculatedCost': 0, 'reserveUnits': {'megacredits': 0, 'steel': 0, 'titanium': 0, 'plants': 0, 'energy': 0, 'heat': 0}}], 'microbes': 0, 'floaters': 0, 'paymentOptions': {'heat': True, 'lunaTradeFederationTitanium': False, 'plants': False, 'corruption': False}, 'lunaArchivesScience': 0, 'seeds': 0, 'graphene': 0, 'kuiperAsteroids': 0, 'corruption': 0}
player_id="p1235b9cd2127"
player_state=json.loads(player_state)
if len(player_id)>0:
    player_state=get_player_state(player_id)
    waiting_for=player_state.get('waitingFor',{})
decision_maker=TerraformingMarsDecisionMapper(DecisionContext())
print(waiting_for)
actions=decision_maker.generate_action_space(waiting_for, player_state)
for idx,action in actions.items():
    print(f"Action id={idx} action={action}")
